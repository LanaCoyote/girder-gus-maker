// startup options
var FULLSCREEN = false;
var WIDTH = FULLSCREEN ? window.innerWidth * window.devicePixelRatio : 800,
    HEIGHT = FULLSCREEN ? window.innerHeight * window.devicePixelRatio : 600;

// initialize the game
var game = new Phaser.Game(WIDTH, HEIGHT, Phaser.AUTO, 'gameContainer');

// add states
game.state.add("boot", initBootState());
game.state.add("load", initLoadState());
game.state.add("game", initGameState());

game.state.start("boot");
var COLORS = {

  BACKGROUND_SKY: "#4428BC"

};

var EPSILON = 0.0001;
function Gus(x, y) {

  this.speed = 250;

  this.sprite = game.add.sprite(x, y, 'Gus');
  this.sprite.anchor.setTo(0.5, 0.5);

  game.physics.enable(this.sprite, Phaser.Physics.ARCADE);

  this.sprite.body.gravity.y = 500;
  this.sprite.body.maxVelocity.y = 1000;

  this.sprite.animations.add('stand', [0], 10, true);
  this.sprite.animations.add('walk', [1, 2], 10, true);

  this.facing = 'right';
  this.rotation = 0;
  this.prevRotation = 0;

  this.rotating = false;
  this.canRotate = true;
  this.targetRotation = 0;
}

Gus.prototype.isTouching = function (side) {
  if (side === "left") {
    if (this.rotation === 0) return this.sprite.body.touching.left;
    if (this.rotation === Math.PI / 2) return this.sprite.body.touching.up;
    if (this.rotation === Math.PI) return this.sprite.body.touching.right;
    if (this.rotation === 3 * Math.PI / 2) return this.sprite.body.touching.down;
  } else {
    if (this.rotation === 0) return this.sprite.body.touching.right;
    if (this.rotation === Math.PI / 2) return this.sprite.body.touching.down;
    if (this.rotation === Math.PI) return this.sprite.body.touching.left;
    if (this.rotation === 3 * Math.PI / 2) return this.sprite.body.touching.up;
  }

  console.error("!!!!!!ALERT!!!!! check Gus.prototype.isTouching because David didn't account for this.rotation being", this.rotation);
};

Gus.prototype.checkForRotation = function (dir) {

  if (dir === "left" && this.isTouching("left")) {
    this.rotate("left");
  } else if (dir === "right" && this.isTouching("right")) {
    this.rotate("right");
  }
};

Gus.prototype.rotate = function (dir) {

  if (dir === "left") {
    var rot = -Math.PI / 2;
  } else {
    var rot = Math.PI / 2;
  }

  this.targetRotation -= rot;
  this.rotating = true;
};

Gus.prototype.finishRotation = function () {

  this.sprite.body.gravity.y = Math.floor(Math.cos(this.rotation) * 500);
  this.sprite.body.gravity.x = Math.floor(Math.sin(this.rotation) * -500);

  this.sprite.rotation = this.rotation;

  this.canRotate = false;
  this.rotating = false;
  delete this.rotateTween;
};

Gus.prototype.walk = function (dir) {

  if (dir === "left") {
    var intendedVelocity = -this.speed;
    this.sprite.scale.x = -1;
  } else {
    var intendedVelocity = this.speed;
    this.sprite.scale.x = 1;
  }

  console.log(this.isTouching("right"), this.rotation === Math.PI / 2);

  var cosine = Math.cos(this.rotation);
  if (Math.abs(cosine) > EPSILON) {
    this.sprite.body.velocity.x = cosine * intendedVelocity;
  } else {
    this.sprite.body.velocity.y = Math.sin(this.rotation) * intendedVelocity;
  }

  this.sprite.animations.play('walk');
  this.canRotate = true;
};

Gus.prototype.stop = function () {

  this.sprite.animations.play('stand');
};

Gus.prototype.update = function () {

  if (Math.abs(Math.cos(this.rotation)) > EPSILON) this.sprite.body.velocity.x = 0;else this.sprite.body.velocity.y = 0;

  if (this.rotating) {

    this.stop();
    this.sprite.body.velocity.y = 0;
    this.sprite.body.velocity.x = 0;

    if (this.rotateTween === undefined) {
      this.rotateTween = game.add.tween(this.sprite).to({ rotation: this.targetRotation }, 1000, Phaser.Easing.Default, true).onComplete.add(function (gus, tween) {
        this.rotation = this.targetRotation % (Math.PI * 2);
        this.finishRotation();
      }, this);
    }

    // if ( this.rotateTime <= 0 ) {
    //   this.rotation = this.targetRotation;
    //   this.finishRotation();
    // } else {
    //   this.rotateTime -= game.time.elapsed;
    //   this.rotation = game.math.linear( this.prevRotation, this.targetRotation, 1 - this.rotateTime );
    //   this.sprite.rotation = this.rotation;
    //   console.log( this.rotation );
    // }
  } else {

      if (cursors.left.isDown) {
        this.walk("left");
        if (this.canRotate) this.checkForRotation("left");
      } else if (cursors.right.isDown) {
        this.walk("right");
        if (this.canRotate) this.checkForRotation("right");
      } else {
        this.stop();
      }
    }
};
function initBootState() {

  var state = {};

  state.create = function () {

    // start game physics
    game.physics.startSystem(Phaser.Physics.ARCADE);

    game.state.start("load");
  };

  return state;
}

function initGameState() {

  var state = {};
  var gus, blocks;

  state.preload = function () {};

  state.create = function () {

    game.add.plugin(Phaser.Plugin.Debug);
    game.world.setBounds(-400, -300, 800, 600);

    gus = new Gus(0, 0);

    blocks = game.add.group();
    blocks.enableBody = true;

    for (var i = 0; i < 10; ++i) {
      var newBlock = blocks.create(-128 + 32 * i, 128, 'BrickRed');
      newBlock.body.immovable = true;
    }

    for (var i = 0; i < 10; ++i) {
      var newBlock = blocks.create(-160, 128 - 32 * i, 'BrickRed');
      newBlock.body.immovable = true;
    }

    for (var i = 0; i < 10; ++i) {
      var newBlock = blocks.create(-256, 128 - 32 * i, 'BrickRed');
      newBlock.body.immovable = true;
    }

    cursors = game.input.keyboard.createCursorKeys();

    game.camera.follow(gus.sprite, game.camera.FOLLOW_PLATFORMER);
  };

  state.update = function () {

    game.physics.arcade.collide(gus.sprite, blocks);

    gus.update();

    game.camera.displayObject.pivot.x = gus.sprite.position.x;
    game.camera.displayObject.pivot.y = gus.sprite.position.y;
    //game.camera.displayObject.rotation = (Math.PI * 2) - gus.sprite.rotation;
    //game.world.rotation = (Math.PI * 2) - gus.rotation;
    //game.physics.arcade.collide( gus.sprite, blocks );
  };

  return state;
}

function initLoadState() {

  var state = {};

  state.preload = function () {
    game.load.image('BrickBlack', 'game/images/brick_black.png');
    game.load.image('BrickBreak', 'game/images/brick_break.png');
    game.load.image('BrickRed', 'game/images/brick_red.png');
    game.load.image('Girder', 'game/images/girder.png');
    game.load.image('Tool', 'game/images/tool.png');
    game.load.spritesheet('Gus', 'game/images/gus.png', 32, 32);
  };

  state.create = function () {

    // set background color
    game.stage.setBackgroundColor(COLORS.BACKGROUND_SKY);

    // start game state
    game.state.start("game");
  };

  return state;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJjb25zdHMvY29sb3JzLmpzIiwiY29uc3RzL2luZGV4LmpzIiwib2JqZWN0cy9ndXMuanMiLCJzdGF0ZXMvYm9vdC5qcyIsInN0YXRlcy9nYW1lLmpzIiwic3RhdGVzL2xvYWQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLElBQUEsYUFBQSxLQUFBO0FBQ0EsSUFBQSxRQUFBLGFBQUEsT0FBQSxVQUFBLEdBQUEsT0FBQSxnQkFBQSxHQUFBLEdBQUE7SUFDQSxTQUFBLGFBQUEsT0FBQSxXQUFBLEdBQUEsT0FBQSxnQkFBQSxHQUFBLEdBQUE7OztBQUdBLElBQUEsT0FBQSxJQUFBLE9BQUEsSUFBQSxDQUFBLEtBQUEsRUFBQSxNQUFBLEVBQUEsT0FBQSxJQUFBLEVBQUEsZUFBQSxDQUFBOzs7QUFHQSxLQUFBLEtBQUEsQ0FBQSxHQUFBLENBQUEsTUFBQSxFQUFBLGVBQUE7QUFDQSxLQUFBLEtBQUEsQ0FBQSxHQUFBLENBQUEsTUFBQSxFQUFBLGVBQUE7QUFDQSxLQUFBLEtBQUEsQ0FBQSxHQUFBLENBQUEsTUFBQSxFQUFBLGVBQUE7O0FBRUEsS0FBQSxLQUFBLENBQUEsS0FBQSxDQUFBLE1BQUE7QUNiQSxJQUFBLFNBQUE7O0FBRUEsa0JBQUEsU0FBQTs7Q0FGQTs7QUNDQSxJQUFBLFVBQUEsTUFBQTtBQ0RBLFNBQUEsR0FBQSxDQUFBLENBQUEsRUFBQSxDQUFBLEVBQUE7O0FBRUEsT0FBQSxLQUFBLEdBQUEsR0FBQSxDQUZBOztBQUlBLE9BQUEsTUFBQSxHQUFBLEtBQUEsR0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEtBQUEsQ0FBQSxDQUpBO0FBS0EsT0FBQSxNQUFBLENBQUEsTUFBQSxDQUFBLEtBQUEsQ0FBQSxHQUFBLEVBQUEsR0FBQSxFQUxBOztBQU9BLE9BQUEsT0FBQSxDQUFBLE1BQUEsQ0FBQSxLQUFBLE1BQUEsRUFBQSxPQUFBLE9BQUEsQ0FBQSxNQUFBLENBQUEsQ0FQQTs7QUFTQSxPQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLENBQUEsR0FBQSxHQUFBLENBVEE7QUFVQSxPQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsV0FBQSxDQUFBLENBQUEsR0FBQSxJQUFBLENBVkE7O0FBWUEsT0FBQSxNQUFBLENBQUEsVUFBQSxDQUFBLEdBQUEsQ0FBQSxPQUFBLEVBQUEsQ0FBQSxDQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsSUFBQSxFQVpBO0FBYUEsT0FBQSxNQUFBLENBQUEsVUFBQSxDQUFBLEdBQUEsQ0FBQSxNQUFBLEVBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLElBQUEsRUFiQTs7QUFlQSxPQUFBLE1BQUEsR0FBQSxPQUFBLENBZkE7QUFnQkEsT0FBQSxRQUFBLEdBQUEsQ0FBQSxDQWhCQTtBQWlCQSxPQUFBLFlBQUEsR0FBQSxDQUFBLENBakJBOztBQW1CQSxPQUFBLFFBQUEsR0FBQSxLQUFBLENBbkJBO0FBb0JBLE9BQUEsU0FBQSxHQUFBLElBQUEsQ0FwQkE7QUFxQkEsT0FBQSxjQUFBLEdBQUEsQ0FBQSxDQXJCQTtDQUFBOztBQXlCQSxJQUFBLFNBQUEsQ0FBQSxVQUFBLEdBQUEsVUFBQSxJQUFBLEVBQUE7QUFDQSxNQUFBLFNBQUEsTUFBQSxFQUFBO0FBQ0EsUUFBQSxLQUFBLFFBQUEsS0FBQSxDQUFBLEVBQUEsT0FBQSxLQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQTtBQUNBLFFBQUEsS0FBQSxRQUFBLEtBQUEsS0FBQSxFQUFBLEdBQUEsQ0FBQSxFQUFBLE9BQUEsS0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsQ0FBQSxFQUFBLENBQUE7QUFDQSxRQUFBLEtBQUEsUUFBQSxLQUFBLEtBQUEsRUFBQSxFQUFBLE9BQUEsS0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsQ0FBQSxLQUFBLENBQUE7QUFDQSxRQUFBLEtBQUEsUUFBQSxLQUFBLElBQUEsS0FBQSxFQUFBLEdBQUEsQ0FBQSxFQUFBLE9BQUEsS0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsQ0FBQSxJQUFBLENBQUE7R0FKQSxNQUtBO0FBQ0EsUUFBQSxLQUFBLFFBQUEsS0FBQSxDQUFBLEVBQUEsT0FBQSxLQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsUUFBQSxDQUFBLEtBQUEsQ0FBQTtBQUNBLFFBQUEsS0FBQSxRQUFBLEtBQUEsS0FBQSxFQUFBLEdBQUEsQ0FBQSxFQUFBLE9BQUEsS0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsQ0FBQSxJQUFBLENBQUE7QUFDQSxRQUFBLEtBQUEsUUFBQSxLQUFBLEtBQUEsRUFBQSxFQUFBLE9BQUEsS0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsQ0FBQSxJQUFBLENBQUE7QUFDQSxRQUFBLEtBQUEsUUFBQSxLQUFBLElBQUEsS0FBQSxFQUFBLEdBQUEsQ0FBQSxFQUFBLE9BQUEsS0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsQ0FBQSxFQUFBLENBQUE7R0FUQTs7QUFZQSxVQUFBLEtBQUEsQ0FBQSxzR0FBQSxFQUFBLEtBQUEsUUFBQSxDQUFBLENBYkE7Q0FBQTs7QUFnQkEsSUFBQSxTQUFBLENBQUEsZ0JBQUEsR0FBQSxVQUFBLEdBQUEsRUFBQTs7QUFFQSxNQUFBLFFBQUEsTUFBQSxJQUFBLEtBQUEsVUFBQSxDQUFBLE1BQUEsQ0FBQSxFQUFBO0FBQ0EsU0FBQSxNQUFBLENBQUEsTUFBQSxFQURBO0dBQUEsTUFFQSxJQUFBLFFBQUEsT0FBQSxJQUFBLEtBQUEsVUFBQSxDQUFBLE9BQUEsQ0FBQSxFQUFBO0FBQ0EsU0FBQSxNQUFBLENBQUEsT0FBQSxFQURBO0dBQUE7Q0FKQTs7QUFVQSxJQUFBLFNBQUEsQ0FBQSxNQUFBLEdBQUEsVUFBQSxHQUFBLEVBQUE7O0FBRUEsTUFBQSxRQUFBLE1BQUEsRUFBQTtBQUNBLFFBQUEsTUFBQSxDQUFBLEtBQUEsRUFBQSxHQUFBLENBQUEsQ0FEQTtHQUFBLE1BRUE7QUFDQSxRQUFBLE1BQUEsS0FBQSxFQUFBLEdBQUEsQ0FBQSxDQURBO0dBRkE7O0FBTUEsT0FBQSxjQUFBLElBQUEsR0FBQSxDQVJBO0FBU0EsT0FBQSxRQUFBLEdBQUEsSUFBQSxDQVRBO0NBQUE7O0FBYUEsSUFBQSxTQUFBLENBQUEsY0FBQSxHQUFBLFlBQUE7O0FBRUEsT0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBLEdBQUEsS0FBQSxLQUFBLENBQUEsS0FBQSxHQUFBLENBQUEsS0FBQSxRQUFBLENBQUEsR0FBQSxHQUFBLENBQUEsQ0FGQTtBQUdBLE9BQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQSxHQUFBLEtBQUEsS0FBQSxDQUFBLEtBQUEsR0FBQSxDQUFBLEtBQUEsUUFBQSxDQUFBLEdBQUEsQ0FBQSxHQUFBLENBQUEsQ0FIQTs7QUFLQSxPQUFBLE1BQUEsQ0FBQSxRQUFBLEdBQUEsS0FBQSxRQUFBLENBTEE7O0FBT0EsT0FBQSxTQUFBLEdBQUEsS0FBQSxDQVBBO0FBUUEsT0FBQSxRQUFBLEdBQUEsS0FBQSxDQVJBO0FBU0EsU0FBQSxLQUFBLFdBQUEsQ0FUQTtDQUFBOztBQWFBLElBQUEsU0FBQSxDQUFBLElBQUEsR0FBQSxVQUFBLEdBQUEsRUFBQTs7QUFFQSxNQUFBLFFBQUEsTUFBQSxFQUFBO0FBQ0EsUUFBQSxtQkFBQSxDQUFBLEtBQUEsS0FBQSxDQURBO0FBRUEsU0FBQSxNQUFBLENBQUEsS0FBQSxDQUFBLENBQUEsR0FBQSxDQUFBLENBQUEsQ0FGQTtHQUFBLE1BR0E7QUFDQSxRQUFBLG1CQUFBLEtBQUEsS0FBQSxDQURBO0FBRUEsU0FBQSxNQUFBLENBQUEsS0FBQSxDQUFBLENBQUEsR0FBQSxDQUFBLENBRkE7R0FIQTs7QUFRQSxVQUFBLEdBQUEsQ0FBQSxLQUFBLFVBQUEsQ0FBQSxPQUFBLENBQUEsRUFBQSxLQUFBLFFBQUEsS0FBQSxLQUFBLEVBQUEsR0FBQSxDQUFBLENBQUEsQ0FWQTs7QUFZQSxNQUFBLFNBQUEsS0FBQSxHQUFBLENBQUEsS0FBQSxRQUFBLENBQUEsQ0FaQTtBQWFBLE1BQUEsS0FBQSxHQUFBLENBQUEsTUFBQSxJQUFBLE9BQUEsRUFBQTtBQUNBLFNBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQSxHQUFBLFNBQUEsZ0JBQUEsQ0FEQTtHQUFBLE1BRUE7QUFDQSxTQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsUUFBQSxDQUFBLENBQUEsR0FBQSxLQUFBLEdBQUEsQ0FBQSxLQUFBLFFBQUEsQ0FBQSxHQUFBLGdCQUFBLENBREE7R0FGQTs7QUFNQSxPQUFBLE1BQUEsQ0FBQSxVQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsRUFuQkE7QUFvQkEsT0FBQSxTQUFBLEdBQUEsSUFBQSxDQXBCQTtDQUFBOztBQXdCQSxJQUFBLFNBQUEsQ0FBQSxJQUFBLEdBQUEsWUFBQTs7QUFFQSxPQUFBLE1BQUEsQ0FBQSxVQUFBLENBQUEsSUFBQSxDQUFBLE9BQUEsRUFGQTtDQUFBOztBQU1BLElBQUEsU0FBQSxDQUFBLE1BQUEsR0FBQSxZQUFBOztBQUVBLE1BQUEsS0FBQSxHQUFBLENBQUEsS0FBQSxHQUFBLENBQUEsS0FBQSxRQUFBLENBQUEsSUFBQSxPQUFBLEVBQUEsS0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBLEtBQ0EsS0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBQSxDQURBOztBQUdBLE1BQUEsS0FBQSxRQUFBLEVBQUE7O0FBRUEsU0FBQSxJQUFBLEdBRkE7QUFHQSxTQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsUUFBQSxDQUFBLENBQUEsR0FBQSxDQUFBLENBSEE7QUFJQSxTQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsUUFBQSxDQUFBLENBQUEsR0FBQSxDQUFBLENBSkE7O0FBTUEsUUFBQSxLQUFBLFdBQUEsS0FBQSxTQUFBLEVBQUE7QUFDQSxXQUFBLFdBQUEsR0FBQSxLQUFBLEdBQUEsQ0FBQSxLQUFBLENBQUEsS0FBQSxNQUFBLENBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxVQUFBLEtBQUEsY0FBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLE9BQUEsTUFBQSxDQUFBLE9BQUEsRUFBQSxJQUFBLEVBQ0EsVUFEQSxDQUNBLEdBREEsQ0FDQSxVQUFBLEdBQUEsRUFBQSxLQUFBLEVBQUE7QUFDQSxhQUFBLFFBQUEsR0FBQSxLQUFBLGNBQUEsSUFBQSxLQUFBLEVBQUEsR0FBQSxDQUFBLENBQUEsQ0FEQTtBQUVBLGFBQUEsY0FBQSxHQUZBO09BQUEsRUFHQSxJQUpBLENBQUEsQ0FEQTtLQUFBOzs7Ozs7Ozs7OztHQU5BLE1Bd0JBO0FBeEJBO0FBMEJBLFVBQUEsUUFBQSxJQUFBLENBQUEsTUFBQSxFQUFBO0FBQ0EsYUFBQSxJQUFBLENBQUEsTUFBQSxFQURBO0FBRUEsWUFBQSxLQUFBLFNBQUEsRUFBQSxLQUFBLGdCQUFBLENBQUEsTUFBQSxFQUFBO09BRkEsTUFHQSxJQUFBLFFBQUEsS0FBQSxDQUFBLE1BQUEsRUFBQTtBQUNBLGFBQUEsSUFBQSxDQUFBLE9BQUEsRUFEQTtBQUVBLFlBQUEsS0FBQSxTQUFBLEVBQUEsS0FBQSxnQkFBQSxDQUFBLE9BQUEsRUFBQTtPQUZBLE1BR0E7QUFDQSxhQUFBLElBQUEsR0FEQTtPQUhBO0tBN0JBO0NBTEE7QUMzR0EsU0FBQSxhQUFBLEdBQUE7O0FBRUEsTUFBQSxRQUFBLEVBQUEsQ0FGQTs7QUFJQSxRQUFBLE1BQUEsR0FBQSxZQUFBOzs7QUFHQSxTQUFBLE9BQUEsQ0FBQSxXQUFBLENBQUEsT0FBQSxPQUFBLENBQUEsTUFBQSxDQUFBLENBSEE7O0FBS0EsU0FBQSxLQUFBLENBQUEsS0FBQSxDQUFBLE1BQUEsRUFMQTtHQUFBLENBSkE7O0FBYUEsU0FBQSxLQUFBLENBYkE7Q0FBQTs7QUNBQSxTQUFBLGFBQUEsR0FBQTs7QUFFQSxNQUFBLFFBQUEsRUFBQSxDQUZBO0FBR0EsTUFBQSxHQUFBLEVBQUEsTUFBQSxDQUhBOztBQUtBLFFBQUEsT0FBQSxHQUFBLFlBQUEsRUFBQSxDQUxBOztBQVNBLFFBQUEsTUFBQSxHQUFBLFlBQUE7O0FBRUEsU0FBQSxHQUFBLENBQUEsTUFBQSxDQUFBLE9BQUEsTUFBQSxDQUFBLEtBQUEsQ0FBQSxDQUZBO0FBR0EsU0FBQSxLQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsR0FBQSxFQUFBLENBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLEVBSEE7O0FBS0EsVUFBQSxJQUFBLEdBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxDQUFBLENBTEE7O0FBT0EsYUFBQSxLQUFBLEdBQUEsQ0FBQSxLQUFBLEVBQUEsQ0FQQTtBQVFBLFdBQUEsVUFBQSxHQUFBLElBQUEsQ0FSQTs7QUFVQSxTQUFBLElBQUEsSUFBQSxDQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxDQUFBLEVBQUE7QUFDQSxVQUFBLFdBQUEsT0FBQSxNQUFBLENBQUEsQ0FBQSxHQUFBLEdBQUEsS0FBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLFVBQUEsQ0FBQSxDQURBO0FBRUEsZUFBQSxJQUFBLENBQUEsU0FBQSxHQUFBLElBQUEsQ0FGQTtLQUFBOztBQUtBLFNBQUEsSUFBQSxJQUFBLENBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsRUFBQTtBQUNBLFVBQUEsV0FBQSxPQUFBLE1BQUEsQ0FBQSxDQUFBLEdBQUEsRUFBQSxNQUFBLEtBQUEsQ0FBQSxFQUFBLFVBQUEsQ0FBQSxDQURBO0FBRUEsZUFBQSxJQUFBLENBQUEsU0FBQSxHQUFBLElBQUEsQ0FGQTtLQUFBOztBQUtBLFNBQUEsSUFBQSxJQUFBLENBQUEsRUFBQSxJQUFBLEVBQUEsRUFBQSxFQUFBLENBQUEsRUFBQTtBQUNBLFVBQUEsV0FBQSxPQUFBLE1BQUEsQ0FBQSxDQUFBLEdBQUEsRUFBQSxNQUFBLEtBQUEsQ0FBQSxFQUFBLFVBQUEsQ0FBQSxDQURBO0FBRUEsZUFBQSxJQUFBLENBQUEsU0FBQSxHQUFBLElBQUEsQ0FGQTtLQUFBOztBQUtBLGNBQUEsS0FBQSxLQUFBLENBQUEsUUFBQSxDQUFBLGdCQUFBLEVBQUEsQ0F6QkE7O0FBMkJBLFNBQUEsTUFBQSxDQUFBLE1BQUEsQ0FBQSxJQUFBLE1BQUEsRUFBQSxLQUFBLE1BQUEsQ0FBQSxpQkFBQSxDQUFBLENBM0JBO0dBQUEsQ0FUQTs7QUF3Q0EsUUFBQSxNQUFBLEdBQUEsWUFBQTs7QUFFQSxTQUFBLE9BQUEsQ0FBQSxNQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsTUFBQSxFQUFBLE1BQUEsRUFGQTs7QUFJQSxRQUFBLE1BQUEsR0FKQTs7QUFNQSxTQUFBLE1BQUEsQ0FBQSxhQUFBLENBQUEsS0FBQSxDQUFBLENBQUEsR0FBQSxJQUFBLE1BQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQSxDQU5BO0FBT0EsU0FBQSxNQUFBLENBQUEsYUFBQSxDQUFBLEtBQUEsQ0FBQSxDQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsUUFBQSxDQUFBLENBQUE7Ozs7R0FQQSxDQXhDQTtBQXdDQTtBQWNBLFNBQUEsS0FBQSxDQXREQTtDQUFBOztBQ0NBLFNBQUEsYUFBQSxHQUFBOztBQUVBLE1BQUEsUUFBQSxFQUFBLENBRkE7O0FBSUEsUUFBQSxPQUFBLEdBQUEsWUFBQTtBQUNBLFNBQUEsSUFBQSxDQUFBLEtBQUEsQ0FBQSxZQUFBLEVBQUEsNkJBQUEsRUFEQTtBQUVBLFNBQUEsSUFBQSxDQUFBLEtBQUEsQ0FBQSxZQUFBLEVBQUEsNkJBQUEsRUFGQTtBQUdBLFNBQUEsSUFBQSxDQUFBLEtBQUEsQ0FBQSxVQUFBLEVBQUEsMkJBQUEsRUFIQTtBQUlBLFNBQUEsSUFBQSxDQUFBLEtBQUEsQ0FBQSxRQUFBLEVBQUEsd0JBQUEsRUFKQTtBQUtBLFNBQUEsSUFBQSxDQUFBLEtBQUEsQ0FBQSxNQUFBLEVBQUEsc0JBQUEsRUFMQTtBQU1BLFNBQUEsSUFBQSxDQUFBLFdBQUEsQ0FBQSxLQUFBLEVBQUEscUJBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQU5BO0dBQUEsQ0FKQTs7QUFhQSxRQUFBLE1BQUEsR0FBQSxZQUFBOzs7QUFHQSxTQUFBLEtBQUEsQ0FBQSxrQkFBQSxDQUFBLE9BQUEsY0FBQSxDQUFBOzs7QUFIQSxRQU1BLENBQUEsS0FBQSxDQUFBLEtBQUEsQ0FBQSxNQUFBLEVBTkE7R0FBQSxDQWJBOztBQXVCQSxTQUFBLEtBQUEsQ0F2QkE7Q0FBQSIsImZpbGUiOiJnaXJkZXItZ3VzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gc3RhcnR1cCBvcHRpb25zXG52YXIgICBGVUxMU0NSRUVOID0gZmFsc2U7XG52YXIgICBXSURUSCAgID0gRlVMTFNDUkVFTiA/IHdpbmRvdy5pbm5lcldpZHRoICogd2luZG93LmRldmljZVBpeGVsUmF0aW8gOiA4MDAsXG4gICAgICBIRUlHSFQgID0gRlVMTFNDUkVFTiA/IHdpbmRvdy5pbm5lckhlaWdodCAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIDogNjAwO1xuXG4vLyBpbml0aWFsaXplIHRoZSBnYW1lXG52YXIgICBnYW1lICAgID0gbmV3IFBoYXNlci5HYW1lKCBXSURUSCwgSEVJR0hULCBQaGFzZXIuQVVUTywgJ2dhbWVDb250YWluZXInICk7XG5cbi8vIGFkZCBzdGF0ZXNcbmdhbWUuc3RhdGUuYWRkKCBcImJvb3RcIiwgaW5pdEJvb3RTdGF0ZSgpICk7XG5nYW1lLnN0YXRlLmFkZCggXCJsb2FkXCIsIGluaXRMb2FkU3RhdGUoKSApO1xuZ2FtZS5zdGF0ZS5hZGQoIFwiZ2FtZVwiLCBpbml0R2FtZVN0YXRlKCkgKTtcblxuZ2FtZS5zdGF0ZS5zdGFydCggXCJib290XCIgKTsiLCJ2YXIgQ09MT1JTID0ge1xuXG4gIEJBQ0tHUk9VTkRfU0tZIDogXCIjNDQyOEJDXCIsXG5cbn0iLCJcbnZhciBFUFNJTE9OID0gMC4wMDAxOyIsImZ1bmN0aW9uIEd1cyh4LCB5KSB7XG5cbiAgICB0aGlzLnNwZWVkID0gMjUwO1xuXG4gICAgdGhpcy5zcHJpdGUgPSBnYW1lLmFkZC5zcHJpdGUoeCwgeSwgJ0d1cycpO1xuICAgIHRoaXMuc3ByaXRlLmFuY2hvci5zZXRUbyggMC41LCAwLjUgKTtcblxuICAgIGdhbWUucGh5c2ljcy5lbmFibGUodGhpcy5zcHJpdGUsIFBoYXNlci5QaHlzaWNzLkFSQ0FERSk7XG5cbiAgICB0aGlzLnNwcml0ZS5ib2R5LmdyYXZpdHkueSA9IDUwMDtcbiAgICB0aGlzLnNwcml0ZS5ib2R5Lm1heFZlbG9jaXR5LnkgPSAxMDAwO1xuXG4gICAgdGhpcy5zcHJpdGUuYW5pbWF0aW9ucy5hZGQoJ3N0YW5kJywgWzBdLCAxMCwgdHJ1ZSk7XG4gICAgdGhpcy5zcHJpdGUuYW5pbWF0aW9ucy5hZGQoJ3dhbGsnLCBbMSwyXSwgMTAsIHRydWUpO1xuXG4gICAgdGhpcy5mYWNpbmcgPSAncmlnaHQnO1xuICAgIHRoaXMucm90YXRpb24gPSAwO1xuICAgIHRoaXMucHJldlJvdGF0aW9uID0gMDtcblxuICAgIHRoaXMucm90YXRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmNhblJvdGF0ZSA9IHRydWU7XG4gICAgdGhpcy50YXJnZXRSb3RhdGlvbiA9IDA7XG4gICAgXG59XG5cbkd1cy5wcm90b3R5cGUuaXNUb3VjaGluZyA9IGZ1bmN0aW9uKCBzaWRlICkge1xuICBpZiAoIHNpZGUgPT09IFwibGVmdFwiICkge1xuICAgIGlmICggdGhpcy5yb3RhdGlvbiA9PT0gMCApICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3ByaXRlLmJvZHkudG91Y2hpbmcubGVmdDtcbiAgICBpZiAoIHRoaXMucm90YXRpb24gPT09IE1hdGguUEkvMiApICAgIHJldHVybiB0aGlzLnNwcml0ZS5ib2R5LnRvdWNoaW5nLnVwO1xuICAgIGlmICggdGhpcy5yb3RhdGlvbiA9PT0gTWF0aC5QSSApICAgICAgcmV0dXJuIHRoaXMuc3ByaXRlLmJvZHkudG91Y2hpbmcucmlnaHQ7XG4gICAgaWYgKCB0aGlzLnJvdGF0aW9uID09PSAzKk1hdGguUEkvMiApICByZXR1cm4gdGhpcy5zcHJpdGUuYm9keS50b3VjaGluZy5kb3duO1xuICB9IGVsc2Uge1xuICAgIGlmICggdGhpcy5yb3RhdGlvbiA9PT0gMCApICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3ByaXRlLmJvZHkudG91Y2hpbmcucmlnaHQ7XG4gICAgaWYgKCB0aGlzLnJvdGF0aW9uID09PSBNYXRoLlBJLzIgKSAgICByZXR1cm4gdGhpcy5zcHJpdGUuYm9keS50b3VjaGluZy5kb3duO1xuICAgIGlmICggdGhpcy5yb3RhdGlvbiA9PT0gTWF0aC5QSSApICAgICAgcmV0dXJuIHRoaXMuc3ByaXRlLmJvZHkudG91Y2hpbmcubGVmdDtcbiAgICBpZiAoIHRoaXMucm90YXRpb24gPT09IDMqTWF0aC5QSS8yICkgIHJldHVybiB0aGlzLnNwcml0ZS5ib2R5LnRvdWNoaW5nLnVwO1xuICB9XG5cbiAgY29uc29sZS5lcnJvciggXCIhISEhISFBTEVSVCEhISEhIGNoZWNrIEd1cy5wcm90b3R5cGUuaXNUb3VjaGluZyBiZWNhdXNlIERhdmlkIGRpZG4ndCBhY2NvdW50IGZvciB0aGlzLnJvdGF0aW9uIGJlaW5nXCIsIHRoaXMucm90YXRpb24gKTtcbn1cblxuR3VzLnByb3RvdHlwZS5jaGVja0ZvclJvdGF0aW9uID0gZnVuY3Rpb24oIGRpciApIHtcblxuICBpZiAoIGRpciA9PT0gXCJsZWZ0XCIgJiYgdGhpcy5pc1RvdWNoaW5nKCBcImxlZnRcIiApICkge1xuICAgIHRoaXMucm90YXRlKCBcImxlZnRcIiApO1xuICB9IGVsc2UgaWYgKCBkaXIgPT09IFwicmlnaHRcIiAmJiB0aGlzLmlzVG91Y2hpbmcoIFwicmlnaHRcIiApICkge1xuICAgIHRoaXMucm90YXRlKCBcInJpZ2h0XCIgKTtcbiAgfVxuXG59XG5cbkd1cy5wcm90b3R5cGUucm90YXRlID0gZnVuY3Rpb24oIGRpciApIHtcblxuICBpZiAoIGRpciA9PT0gXCJsZWZ0XCIgKSB7XG4gICAgdmFyIHJvdCA9IC1NYXRoLlBJIC8gMjtcbiAgfSBlbHNlIHtcbiAgICB2YXIgcm90ID0gTWF0aC5QSSAvIDI7XG4gIH1cblxuICB0aGlzLnRhcmdldFJvdGF0aW9uIC09IHJvdDtcbiAgdGhpcy5yb3RhdGluZyA9IHRydWU7XG5cbn1cblxuR3VzLnByb3RvdHlwZS5maW5pc2hSb3RhdGlvbiA9IGZ1bmN0aW9uKCkge1xuXG4gIHRoaXMuc3ByaXRlLmJvZHkuZ3Jhdml0eS55ID0gTWF0aC5mbG9vciggTWF0aC5jb3MoIHRoaXMucm90YXRpb24gKSAqIDUwMCApO1xuICB0aGlzLnNwcml0ZS5ib2R5LmdyYXZpdHkueCA9IE1hdGguZmxvb3IoIE1hdGguc2luKCB0aGlzLnJvdGF0aW9uICkgKiAtNTAwICk7XG5cbiAgdGhpcy5zcHJpdGUucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uO1xuXG4gIHRoaXMuY2FuUm90YXRlID0gZmFsc2U7XG4gIHRoaXMucm90YXRpbmcgPSBmYWxzZTtcbiAgZGVsZXRlIHRoaXMucm90YXRlVHdlZW47XG5cbn1cblxuR3VzLnByb3RvdHlwZS53YWxrID0gZnVuY3Rpb24oIGRpciApIHtcblxuICBpZiAoIGRpciA9PT0gXCJsZWZ0XCIgKSB7XG4gICAgdmFyIGludGVuZGVkVmVsb2NpdHkgPSAtdGhpcy5zcGVlZDtcbiAgICB0aGlzLnNwcml0ZS5zY2FsZS54ID0gLTE7XG4gIH0gZWxzZSB7XG4gICAgdmFyIGludGVuZGVkVmVsb2NpdHkgPSB0aGlzLnNwZWVkO1xuICAgIHRoaXMuc3ByaXRlLnNjYWxlLnggPSAxO1xuICB9XG5cbiAgY29uc29sZS5sb2coIHRoaXMuaXNUb3VjaGluZyggXCJyaWdodFwiICksIHRoaXMucm90YXRpb24gPT09IE1hdGguUEkvMiApO1xuXG4gIHZhciBjb3NpbmUgPSBNYXRoLmNvcyggdGhpcy5yb3RhdGlvbiApO1xuICBpZiAoIE1hdGguYWJzKCBjb3NpbmUgKSA+IEVQU0lMT04gKSB7XG4gICAgdGhpcy5zcHJpdGUuYm9keS52ZWxvY2l0eS54ID0gY29zaW5lICogaW50ZW5kZWRWZWxvY2l0eTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLnNwcml0ZS5ib2R5LnZlbG9jaXR5LnkgPSBNYXRoLnNpbiggdGhpcy5yb3RhdGlvbiApICogaW50ZW5kZWRWZWxvY2l0eTtcbiAgfVxuXG4gIHRoaXMuc3ByaXRlLmFuaW1hdGlvbnMucGxheSggJ3dhbGsnICk7XG4gIHRoaXMuY2FuUm90YXRlID0gdHJ1ZTtcblxufVxuXG5HdXMucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbigpIHtcblxuICB0aGlzLnNwcml0ZS5hbmltYXRpb25zLnBsYXkoICdzdGFuZCcgKTtcblxufVxuXG5HdXMucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuXG4gIGlmICggTWF0aC5hYnMoIE1hdGguY29zKCB0aGlzLnJvdGF0aW9uICkgKSA+IEVQU0lMT04gKSB0aGlzLnNwcml0ZS5ib2R5LnZlbG9jaXR5LnggPSAwO1xuICBlbHNlIHRoaXMuc3ByaXRlLmJvZHkudmVsb2NpdHkueSA9IDA7XG5cbiAgaWYgKCB0aGlzLnJvdGF0aW5nICkge1xuXG4gICAgdGhpcy5zdG9wKCk7XG4gICAgdGhpcy5zcHJpdGUuYm9keS52ZWxvY2l0eS55ID0gMDtcbiAgICB0aGlzLnNwcml0ZS5ib2R5LnZlbG9jaXR5LnggPSAwO1xuXG4gICAgaWYgKCB0aGlzLnJvdGF0ZVR3ZWVuID09PSB1bmRlZmluZWQgKSB7XG4gICAgICB0aGlzLnJvdGF0ZVR3ZWVuID0gZ2FtZS5hZGQudHdlZW4oIHRoaXMuc3ByaXRlICkudG8oIHsgcm90YXRpb246IHRoaXMudGFyZ2V0Um90YXRpb24gfSwgMTAwMCwgUGhhc2VyLkVhc2luZy5EZWZhdWx0LCB0cnVlIClcbiAgICAgIC5vbkNvbXBsZXRlLmFkZCggZnVuY3Rpb24oIGd1cywgdHdlZW4gKSB7XG4gICAgICAgIHRoaXMucm90YXRpb24gPSB0aGlzLnRhcmdldFJvdGF0aW9uICUgKCBNYXRoLlBJICogMiApO1xuICAgICAgICB0aGlzLmZpbmlzaFJvdGF0aW9uKCk7XG4gICAgICB9LCB0aGlzICk7XG4gICAgfVxuXG4gICAgLy8gaWYgKCB0aGlzLnJvdGF0ZVRpbWUgPD0gMCApIHtcbiAgICAvLyAgIHRoaXMucm90YXRpb24gPSB0aGlzLnRhcmdldFJvdGF0aW9uO1xuICAgIC8vICAgdGhpcy5maW5pc2hSb3RhdGlvbigpO1xuICAgIC8vIH0gZWxzZSB7XG4gICAgLy8gICB0aGlzLnJvdGF0ZVRpbWUgLT0gZ2FtZS50aW1lLmVsYXBzZWQ7XG4gICAgLy8gICB0aGlzLnJvdGF0aW9uID0gZ2FtZS5tYXRoLmxpbmVhciggdGhpcy5wcmV2Um90YXRpb24sIHRoaXMudGFyZ2V0Um90YXRpb24sIDEgLSB0aGlzLnJvdGF0ZVRpbWUgKTtcbiAgICAvLyAgIHRoaXMuc3ByaXRlLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbjtcbiAgICAvLyAgIGNvbnNvbGUubG9nKCB0aGlzLnJvdGF0aW9uICk7XG4gICAgLy8gfVxuXG4gIH0gZWxzZSB7XG5cbiAgICBpZiAoIGN1cnNvcnMubGVmdC5pc0Rvd24gKSB7XG4gICAgICB0aGlzLndhbGsoIFwibGVmdFwiICk7XG4gICAgICBpZiAoIHRoaXMuY2FuUm90YXRlICkgdGhpcy5jaGVja0ZvclJvdGF0aW9uKCBcImxlZnRcIiApO1xuICAgIH0gZWxzZSBpZiAoIGN1cnNvcnMucmlnaHQuaXNEb3duICkge1xuICAgICAgdGhpcy53YWxrKCBcInJpZ2h0XCIgKTtcbiAgICAgIGlmICggdGhpcy5jYW5Sb3RhdGUgKSB0aGlzLmNoZWNrRm9yUm90YXRpb24oIFwicmlnaHRcIiApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN0b3AoKTtcbiAgICB9XG5cbiAgICBcblxuICB9XG5cbn0iLCJmdW5jdGlvbiBpbml0Qm9vdFN0YXRlKCkge1xuXG4gIHZhciBzdGF0ZSA9IHt9O1xuXG4gIHN0YXRlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgLy8gc3RhcnQgZ2FtZSBwaHlzaWNzXG4gICAgZ2FtZS5waHlzaWNzLnN0YXJ0U3lzdGVtKCBQaGFzZXIuUGh5c2ljcy5BUkNBREUgKTtcblxuICAgIGdhbWUuc3RhdGUuc3RhcnQoIFwibG9hZFwiICk7XG5cbiAgfVxuXG4gIHJldHVybiBzdGF0ZTtcblxufVxuIiwiZnVuY3Rpb24gaW5pdEdhbWVTdGF0ZSgpIHtcblxuICB2YXIgc3RhdGUgPSB7fTtcbiAgdmFyIGd1cywgYmxvY2tzO1xuXG4gIHN0YXRlLnByZWxvYWQgPSBmdW5jdGlvbiAoKSB7XG5cbiAgfVxuXG4gIHN0YXRlLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgIGdhbWUuYWRkLnBsdWdpbiggUGhhc2VyLlBsdWdpbi5EZWJ1ZyApO1xuICAgIGdhbWUud29ybGQuc2V0Qm91bmRzKCAtNDAwLCAtMzAwLCA4MDAsIDYwMCApO1xuXG4gICAgZ3VzID0gbmV3IEd1cyggMCwgMCApO1xuXG4gICAgYmxvY2tzID0gZ2FtZS5hZGQuZ3JvdXAoKTtcbiAgICBibG9ja3MuZW5hYmxlQm9keSA9IHRydWU7XG5cbiAgICBmb3IoIHZhciBpID0gMDsgaSA8IDEwOyArK2kgKSB7XG4gICAgICB2YXIgbmV3QmxvY2sgPSBibG9ja3MuY3JlYXRlKCAtMTI4ICsgKDMyICogaSksIDEyOCwgJ0JyaWNrUmVkJyApO1xuICAgICAgbmV3QmxvY2suYm9keS5pbW1vdmFibGUgPSB0cnVlO1xuICAgIH1cblxuICAgIGZvciggdmFyIGkgPSAwOyBpIDwgMTA7ICsraSApIHtcbiAgICAgIHZhciBuZXdCbG9jayA9IGJsb2Nrcy5jcmVhdGUoIC0xNjAsIDEyOCAtICgzMiAqIGkpLCAnQnJpY2tSZWQnICk7XG4gICAgICBuZXdCbG9jay5ib2R5LmltbW92YWJsZSA9IHRydWU7XG4gICAgfVxuXG4gICAgZm9yKCB2YXIgaSA9IDA7IGkgPCAxMDsgKytpICkge1xuICAgICAgdmFyIG5ld0Jsb2NrID0gYmxvY2tzLmNyZWF0ZSggLTI1NiwgMTI4IC0gKDMyICogaSksICdCcmlja1JlZCcgKTtcbiAgICAgIG5ld0Jsb2NrLmJvZHkuaW1tb3ZhYmxlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBjdXJzb3JzID0gZ2FtZS5pbnB1dC5rZXlib2FyZC5jcmVhdGVDdXJzb3JLZXlzKCk7XG5cbiAgICBnYW1lLmNhbWVyYS5mb2xsb3coIGd1cy5zcHJpdGUsIGdhbWUuY2FtZXJhLkZPTExPV19QTEFURk9STUVSICk7XG5cbiAgfVxuXG4gIHN0YXRlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgIGdhbWUucGh5c2ljcy5hcmNhZGUuY29sbGlkZSggZ3VzLnNwcml0ZSwgYmxvY2tzICk7XG5cbiAgICBndXMudXBkYXRlKCk7XG5cbiAgICBnYW1lLmNhbWVyYS5kaXNwbGF5T2JqZWN0LnBpdm90LnggPSBndXMuc3ByaXRlLnBvc2l0aW9uLng7XG4gICAgZ2FtZS5jYW1lcmEuZGlzcGxheU9iamVjdC5waXZvdC55ID0gZ3VzLnNwcml0ZS5wb3NpdGlvbi55O1xuICAgIC8vZ2FtZS5jYW1lcmEuZGlzcGxheU9iamVjdC5yb3RhdGlvbiA9IChNYXRoLlBJICogMikgLSBndXMuc3ByaXRlLnJvdGF0aW9uO1xuICAgIC8vZ2FtZS53b3JsZC5yb3RhdGlvbiA9IChNYXRoLlBJICogMikgLSBndXMucm90YXRpb247XG4gICAgLy9nYW1lLnBoeXNpY3MuYXJjYWRlLmNvbGxpZGUoIGd1cy5zcHJpdGUsIGJsb2NrcyApO1xuXG4gIH1cblxuICByZXR1cm4gc3RhdGU7XG5cbn1cbiIsIlxuZnVuY3Rpb24gaW5pdExvYWRTdGF0ZSgpIHtcblxuICB2YXIgc3RhdGUgPSB7fTtcblxuICBzdGF0ZS5wcmVsb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgZ2FtZS5sb2FkLmltYWdlKCdCcmlja0JsYWNrJywgJ2dhbWUvaW1hZ2VzL2JyaWNrX2JsYWNrLnBuZycpO1xuICAgICAgZ2FtZS5sb2FkLmltYWdlKCdCcmlja0JyZWFrJywgJ2dhbWUvaW1hZ2VzL2JyaWNrX2JyZWFrLnBuZycpO1xuICAgICAgZ2FtZS5sb2FkLmltYWdlKCdCcmlja1JlZCcsICdnYW1lL2ltYWdlcy9icmlja19yZWQucG5nJyk7XG4gICAgICBnYW1lLmxvYWQuaW1hZ2UoJ0dpcmRlcicsICdnYW1lL2ltYWdlcy9naXJkZXIucG5nJyk7XG4gICAgICBnYW1lLmxvYWQuaW1hZ2UoJ1Rvb2wnLCAnZ2FtZS9pbWFnZXMvdG9vbC5wbmcnKTtcbiAgICAgIGdhbWUubG9hZC5zcHJpdGVzaGVldCgnR3VzJywgJ2dhbWUvaW1hZ2VzL2d1cy5wbmcnLCAzMiwgMzIpO1xuICB9XG5cbiAgc3RhdGUuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAvLyBzZXQgYmFja2dyb3VuZCBjb2xvclxuICAgICAgZ2FtZS5zdGFnZS5zZXRCYWNrZ3JvdW5kQ29sb3IoIENPTE9SUy5CQUNLR1JPVU5EX1NLWSApO1xuXG4gICAgICAvLyBzdGFydCBnYW1lIHN0YXRlXG4gICAgICBnYW1lLnN0YXRlLnN0YXJ0KCBcImdhbWVcIiApO1xuXG4gIH1cblxuICByZXR1cm4gc3RhdGU7XG5cbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
